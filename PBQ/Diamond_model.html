<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CySA+ Diamond Intrusion Model — Elements + Relationships Drag & Drop</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#141a22; --panel2:#0f141b;
    --ink:#e6edf3; --muted:#9db0c5;
    --good:#2ecc71; --bad:#ff6b6b; --accent:#4da3ff; --accent2:#7c5cff;
    --radius:16px;
  }

  *{box-sizing:border-box}

  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(1200px 800px at 10% -10%, #1a2330 0%, transparent 55%),
      radial-gradient(900px 700px at 110% 10%, #151a2b 0%, transparent 60%),
      var(--bg);
    color:var(--ink);
  }

  /* FORCE LIGHT TEXT EVERYWHERE BY DEFAULT */
  body, body *{
    color:var(--ink);
  }

  header{
    position:sticky; top:0; z-index:5;
    background:linear-gradient(180deg, rgba(11,15,20,.98), rgba(11,15,20,.7));
    backdrop-filter: blur(6px);
    border-bottom:1px solid #1f2a36;
  }

  .wrap{max-width:1100px; margin:0 auto; padding:12px 14px;}
  h1{font-size:1.1rem; margin:0; letter-spacing:.4px; color:var(--ink);}

  .grid{display:grid; gap:12px; margin-top:12px; grid-template-columns:1fr;}
  @media(min-width:900px){ .grid.two{grid-template-columns:1fr 1.2fr;} }

  .card{
    background:linear-gradient(180deg, var(--panel), var(--panel2));
    border:1px solid #1f2a36;
    border-radius:var(--radius);
    padding:14px;
    box-shadow:0 8px 20px rgba(0,0,0,.35);
    color:var(--ink);
  }

  /* muted text overrides */
  .muted{color:var(--muted)!important; font-size:.92rem; line-height:1.45}
  .tiny{font-size:.85rem; color:var(--muted)!important;}

  .pill{
    display:inline-flex; align-items:center; gap:6px;
    background:#0b121a; border:1px solid #233146; color:#cfe3ff!important;
    padding:4px 8px; border-radius:999px; font-size:.8rem; font-weight:800;
  }

  .btn-row{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;}
  .btn{
    border:1px solid #2a3a50; background:#0f1620; color:var(--ink)!important;
    padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:900;
    transition:.15s transform ease, .15s border ease, .15s background ease;
    width:100%;
  }
  .btn:hover{border-color:#3d5676}
  .btn:active{transform:translateY(1px) scale(.99)}
  .btn-row .btn{width:auto; flex:1 1 140px;}

  /* Draggables */
  .bank{
    display:flex; flex-direction:column; gap:8px;
    min-height:260px; padding:8px; border-radius:12px;
    background:#0c1118; border:1px dashed #243244;
  }
  .item{
    padding:10px 12px; border-radius:12px; background:#0e1520;
    border:1px solid #233146; cursor:grab; font-weight:900; user-select:none;
    display:flex; flex-direction:column; gap:4px;
    touch-action:none;
    color:var(--ink)!important;
  }
  .item small{font-weight:600; color:var(--muted)!important}
  .item.dragging{opacity:.5}

  /* Diamond area */
  .diamond-stage{
    position:relative;
    background:#0c1118;
    border:1px dashed #243244;
    border-radius:14px;
    padding:10px;
    min-height:420px;
  }
  svg{width:100%; height:auto; display:block;}

  /* Element drop zones (blank) */
  .zone{
    position:absolute;
    transform:translate(-50%,-50%);
    min-width:110px;
    max-width:42%;
    padding:8px 10px;
    border-radius:12px;
    background:#0e1622;
    border:1px dashed #223147;
    text-align:center;
    font-weight:900;
    font-size:.95rem;
    color:var(--ink)!important;
  }
  .zone .zdrop{
    display:block;
    font-weight:800;
    color:var(--muted)!important;
    font-size:.85rem;
    padding:6px;
    border-radius:8px;
    background:#0b121a;
    border:1px dashed #223147;
  }
  .zone.hover{outline:2px dashed var(--accent); outline-offset:2px;}
  .zone.filled{
    border-style:solid; border-color:#233146; background:#0f1825;
  }
  .zone.filled .zdrop{color:var(--ink)!important; border-style:solid; background:#0f1825;}
  .zone.correct{border-color:rgba(46,204,113,.9); background:rgba(46,204,113,.08)}
  .zone.wrong{border-color:rgba(255,107,107,.9); background:rgba(255,107,107,.08)}

  /* Positions (diamond corners/sides) */
  .zone.top{left:50%; top:8%;}
  .zone.right{left:90%; top:50%;}
  .zone.bottom{left:50%; top:92%;}
  .zone.left{left:10%; top:50%;}

  /* Relationship drop zones */
  .relzone{
    position:absolute;
    transform:translate(-50%,-50%);
    min-width:120px;
    padding:6px 8px;
    border-radius:999px;
    background:#0d1520;
    border:1px dashed #2a3a50;
    text-align:center;
    font-weight:900;
    font-size:.9rem;
    color:var(--ink)!important;
  }
  .relzone .rdrop{
    display:block;
    color:var(--muted)!important;
    font-size:.82rem; font-weight:800;
    padding:4px 6px; border-radius:999px;
    background:#0b121a; border:1px dashed #223147;
  }
  .relzone.hover{outline:2px dashed var(--accent); outline-offset:2px;}
  .relzone.filled{border-style:solid; border-color:#233146; background:#0f1825;}
  .relzone.filled .rdrop{color:var(--ink)!important; border-style:solid; background:#0f1825;}
  .relzone.correct{border-color:rgba(46,204,113,.9); background:rgba(46,204,113,.08)}
  .relzone.wrong{border-color:rgba(255,107,107,.9); background:rgba(255,107,107,.08)}

  /* Relationship positions */
  .relzone.tr{left:73%; top:26%;}
  .relzone.rb{left:73%; top:74%;}
  .relzone.bl{left:27%; top:74%;}
  .relzone.lt{left:27%; top:26%;}

  .scoreline{display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:8px;}
  .progress{
    height:8px; background:#0b121a; border:1px solid #202b3a; border-radius:999px; overflow:hidden;
  }
  .progress > div{
    height:100%; width:0%;
    background:linear-gradient(90deg, var(--accent), var(--accent2));
    transition:width .25s ease;
  }

  .legend{
    display:grid; gap:8px; margin-top:8px; grid-template-columns:1fr;
  }
  @media(min-width:520px){ .legend{grid-template-columns:1fr 1fr;} }
  .legend-item{
    background:#0c1118; border:1px solid #223147; border-radius:12px; padding:8px;
    font-size:.9rem; color:var(--ink)!important; font-weight:800;
  }
  .legend-item b{color:var(--ink)!important;}
  .hidden{display:none!important;}

  @media(max-width:480px){
    .zone{min-width:90px; font-size:.9rem}
    .zone .zdrop,.relzone .rdrop{font-size:.78rem}
    .relzone{min-width:100px}
  }
</style>
</head>
<body>

<header>
  <div class="wrap"><h1>Diamond Intrusion Model — Elements + Relationships Drag & Drop</h1></div>
</header>

<main class="wrap grid two">

  <!-- LEFT: BANK -->
  <section class="card">
    <div class="pill">Drag Bank</div>
    <p class="muted" style="margin-top:8px">
      Drag the <b>4 elements</b> and the <b>4 relationship verbs</b> into the blank diamond.
      No labels on the diagram — you have to remember placement.
    </p>

    <div class="progress"><div id="prog"></div></div>
    <div class="scoreline">
      <div class="tiny">Placed: <span id="placedCount">0</span>/8</div>
      <div class="tiny">Correct: <span id="correctCount">0</span></div>
    </div>

    <div style="height:8px"></div>
    <div id="bank" class="bank" aria-label="draggable items"></div>

    <div class="btn-row">
      <button class="btn" id="checkBtn">Check Answers</button>
      <button class="btn" id="resetBtn">Reset</button>
      <button class="btn" id="shuffleBtn">Shuffle</button>
      <button class="btn" id="hintBtn">Toggle Hints</button>
      <button class="btn" id="revealBtn">Reveal Map</button>
    </div>

    <div id="summary" class="muted" style="margin-top:10px"></div>
  </section>

  <!-- RIGHT: DIAMOND -->
  <section class="card">
    <div class="pill">Diamond Diagram</div>
    <p class="muted" style="margin-top:8px">
      Drop elements on corners, and relationship verbs on the edges.
    </p>

    <div class="diamond-stage" id="stage">
      <svg viewBox="0 0 400 400" aria-hidden="true">
        <defs>
          <linearGradient id="g" x1="0" x2="1">
            <stop offset="0%" stop-color="#1b2a3f"/>
            <stop offset="100%" stop-color="#0f2034"/>
          </linearGradient>
        </defs>
        <polygon points="200,25 375,200 200,375 25,200"
                 fill="url(#g)" stroke="#38547a" stroke-width="3"/>
        <line x1="200" y1="25" x2="200" y2="375" stroke="#2a3a50" stroke-width="2" opacity="0.7"/>
        <line x1="25" y1="200" x2="375" y2="200" stroke="#2a3a50" stroke-width="2" opacity="0.7"/>
      </svg>

      <!-- Element drop zones (blank) -->
      <div class="zone top dropzone" data-zone="capability"><span class="zdrop">Drop element</span></div>
      <div class="zone right dropzone" data-zone="infrastructure"><span class="zdrop">Drop element</span></div>
      <div class="zone bottom dropzone" data-zone="victim"><span class="zdrop">Drop element</span></div>
      <div class="zone left dropzone" data-zone="adversary"><span class="zdrop">Drop element</span></div>

      <!-- Relationship drop zones (blank edges) -->
      <div class="relzone lt reldrop" data-rel="develops"><span class="rdrop">Drop relationship</span></div>
      <div class="relzone tr reldrop" data-rel="uses"><span class="rdrop">Drop relationship</span></div>
      <div class="relzone rb reldrop" data-rel="targets"><span class="rdrop">Drop relationship</span></div>
      <div class="relzone bl reldrop" data-rel="attracts"><span class="rdrop">Drop relationship</span></div>
    </div>

    <!-- Reveal legend (hidden by default) -->
    <div id="legend" class="legend hidden" style="margin-top:10px">
      <div class="legend-item"><b>Top:</b> Capability</div>
      <div class="legend-item"><b>Right:</b> Infrastructure</div>
      <div class="legend-item"><b>Bottom:</b> Victim</div>
      <div class="legend-item"><b>Left:</b> Adversary</div>
      <div class="legend-item"><b>Adversary → Capability:</b> Develops</div>
      <div class="legend-item"><b>Capability → Infrastructure:</b> Uses</div>
      <div class="legend-item"><b>Infrastructure → Victim:</b> Targets</div>
      <div class="legend-item"><b>Victim → Adversary:</b> Attracts</div>
    </div>
  </section>

</main>

<script>
/* =========================
   DATA
========================= */
const ELEMENTS = [
  { id:"adversary", title:"Adversary", hint:"Who is attacking?", example:"APT group, criminal, insider" },
  { id:"capability", title:"Capability", hint:"What do they use?", example:"Malware, exploit, TTPs" },
  { id:"infrastructure", title:"Infrastructure", hint:"Where/how delivered?", example:"C2, domains, IPs, botnet" },
  { id:"victim", title:"Victim", hint:"Who/what is targeted?", example:"Org, users, systems, sector" }
];

const RELS = [
  { id:"develops", title:"Develops", hint:"Adversary → Capability", example:"Actor creates tools/malware" },
  { id:"uses", title:"Uses", hint:"Capability → Infrastructure", example:"Tools leverage infra" },
  { id:"targets", title:"Targets", hint:"Infrastructure → Victim", example:"Infra reaches victim" },
  { id:"attracts", title:"Attracts", hint:"Victim → Adversary", example:"Victim value draws attacker" }
];

const ALL_TILES = [
  ...ELEMENTS.map(e=>({type:"element",...e})),
  ...RELS.map(r=>({type:"rel",...r}))
];

const shuffle = (arr) => {
  const a = arr.slice();
  for (let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
};
const el = (q)=>document.querySelector(q);

let order = shuffle(ALL_TILES);
let placed = { elements:{}, rels:{} };
let hintsOn = false;
let labelsRevealed = false;

/* =========================
   RENDER BANK
========================= */
const bank = el("#bank");
const elemZones = [...document.querySelectorAll(".dropzone")];
const relZones  = [...document.querySelectorAll(".reldrop")];
const allZones  = [...elemZones, ...relZones];

function renderBank(){
  bank.innerHTML="";
  order.forEach(t=>{
    const d = document.createElement("div");
    d.className="item";
    d.draggable=true;
    d.dataset.itemId=t.id;
    d.dataset.type=t.type;
    d.innerHTML = `
      <div>${t.title}</div>
      <small class="hint" style="display:${hintsOn?'block':'none'}">
        Hint: ${t.hint}<br/>Example: ${t.example}
      </small>
    `;
    d.addEventListener("dragstart",(ev)=>{
      ev.dataTransfer.setData("text/plain", JSON.stringify({id:t.id,type:t.type}));
      d.classList.add("dragging");
    });
    d.addEventListener("dragend",()=>d.classList.remove("dragging"));
    enableTouchDrag(d);
    bank.appendChild(d);
  });
}

function resetZonesVisual(){
  elemZones.forEach(z=>{
    z.classList.remove("hover","filled","correct","wrong");
    z.querySelector(".zdrop").textContent="Drop element";
    z.querySelector(".zdrop").style.color="var(--muted)";
  });
  relZones.forEach(z=>{
    z.classList.remove("hover","filled","correct","wrong");
    z.querySelector(".rdrop").textContent="Drop relationship";
    z.querySelector(".rdrop").style.color="var(--muted)";
  });
}

/* =========================
   DROP LOGIC
========================= */
allZones.forEach(z=>{
  z.addEventListener("dragover",(e)=>{e.preventDefault(); z.classList.add("hover");});
  z.addEventListener("dragleave",()=>z.classList.remove("hover"));
  z.addEventListener("drop",(e)=>{
    e.preventDefault();
    z.classList.remove("hover");
    const payload = JSON.parse(e.dataTransfer.getData("text/plain"));
    placeItem(z, payload.id, payload.type);
  });
});

function placeItem(zone, itemId, type){
  if(zone.classList.contains("dropzone") && type!=="element") return;
  if(zone.classList.contains("reldrop")  && type!=="rel") return;

  if(type==="element"){
    for(const zId in placed.elements){
      if(placed.elements[zId]===itemId){
        const oldZone = elemZones.find(x=>x.dataset.zone===zId);
        if(oldZone){
          oldZone.classList.remove("filled","correct","wrong");
          oldZone.querySelector(".zdrop").textContent="Drop element";
          oldZone.querySelector(".zdrop").style.color="var(--muted)";
        }
        delete placed.elements[zId];
      }
    }
    const zoneId = zone.dataset.zone;
    placed.elements[zoneId]=itemId;
    zone.classList.add("filled");
    zone.querySelector(".zdrop").textContent = ELEMENTS.find(x=>x.id===itemId).title;
    zone.querySelector(".zdrop").style.color="var(--ink)";
  } else {
    for(const zId in placed.rels){
      if(placed.rels[zId]===itemId){
        const oldZone = relZones.find(x=>x.dataset.rel===zId);
        if(oldZone){
          oldZone.classList.remove("filled","correct","wrong");
          oldZone.querySelector(".rdrop").textContent="Drop relationship";
          oldZone.querySelector(".rdrop").style.color="var(--muted)";
        }
        delete placed.rels[zId];
      }
    }
    const zoneId = zone.dataset.rel;
    placed.rels[zoneId]=itemId;
    zone.classList.add("filled");
    zone.querySelector(".rdrop").textContent = RELS.find(x=>x.id===itemId).title;
    zone.querySelector(".rdrop").style.color="var(--ink)";
  }

  updateProgress();
}

function updateProgress(){
  const placedCount = Object.keys(placed.elements).length + Object.keys(placed.rels).length;
  el("#placedCount").textContent = placedCount;
  el("#prog").style.width = (placedCount/8*100).toFixed(0)+"%";
}

/* =========================
   CHECK / RESET / SHUFFLE / HINTS / REVEAL
========================= */
el("#checkBtn").addEventListener("click", ()=>{
  let correct=0;

  elemZones.forEach(z=>{
    const zoneId=z.dataset.zone;
    const got=placed.elements[zoneId];
    z.classList.remove("correct","wrong");
    if(!got) return;
    if(got===zoneId){ z.classList.add("correct"); correct++; }
    else { z.classList.add("wrong"); }
  });

  relZones.forEach(z=>{
    const zoneId=z.dataset.rel;
    const got=placed.rels[zoneId];
    z.classList.remove("correct","wrong");
    if(!got) return;
    if(got===zoneId){ z.classList.add("correct"); correct++; }
    else { z.classList.add("wrong"); }
  });

  el("#correctCount").textContent=correct;

  const summary=el("#summary");
  summary.innerHTML = (correct===8)
    ? `<b style="color:var(--good)">Perfect. Elements + relationships are locked in.</b>`
    : `You got <b>${correct}/8</b>. Fix the red zones and check again.`;
});

el("#resetBtn").addEventListener("click", ()=>{
  placed={elements:{},rels:{}};
  resetZonesVisual();
  updateProgress();
  el("#correctCount").textContent=0;
  el("#summary").textContent="";
});

el("#shuffleBtn").addEventListener("click", ()=>{
  order=shuffle(ALL_TILES);
  placed={elements:{},rels:{}};
  renderBank();
  resetZonesVisual();
  updateProgress();
  el("#correctCount").textContent=0;
  el("#summary").textContent="";
});

el("#hintBtn").addEventListener("click", ()=>{
  hintsOn=!hintsOn;
  renderBank();
});

el("#revealBtn").addEventListener("click", ()=>{
  labelsRevealed=!labelsRevealed;
  el("#legend").classList.toggle("hidden", !labelsRevealed);

  elemZones.forEach(z=>{
    if(labelsRevealed && !z.classList.contains("filled")){
      z.querySelector(".zdrop").textContent = z.dataset.zone.toUpperCase();
      z.querySelector(".zdrop").style.color="var(--muted)";
    }
    if(!labelsRevealed && !z.classList.contains("filled")){
      z.querySelector(".zdrop").textContent="Drop element";
      z.querySelector(".zdrop").style.color="var(--muted)";
    }
  });

  relZones.forEach(z=>{
    if(labelsRevealed && !z.classList.contains("filled")){
      z.querySelector(".rdrop").textContent = z.dataset.rel.toUpperCase();
      z.querySelector(".rdrop").style.color="var(--muted)";
    }
    if(!labelsRevealed && !z.classList.contains("filled")){
      z.querySelector(".rdrop").textContent="Drop relationship";
      z.querySelector(".rdrop").style.color="var(--muted)";
    }
  });
});

/* =========================
   TOUCH DRAG SUPPORT
========================= */
function enableTouchDrag(node){
  let dragging=false, ghost=null, offsetX=0, offsetY=0;

  node.addEventListener("pointerdown",(e)=>{
    if(e.pointerType==="mouse") return;
    dragging=true;
    node.setPointerCapture(e.pointerId);

    const rect=node.getBoundingClientRect();
    offsetX=e.clientX-rect.left;
    offsetY=e.clientY-rect.top;

    ghost=node.cloneNode(true);
    ghost.style.position="fixed";
    ghost.style.left=rect.left+"px";
    ghost.style.top=rect.top+"px";
    ghost.style.width=rect.width+"px";
    ghost.style.opacity="0.95";
    ghost.style.zIndex="9999";
    ghost.style.pointerEvents="none";
    document.body.appendChild(ghost);
    node.style.opacity="0.4";
  });

  node.addEventListener("pointermove",(e)=>{
    if(!dragging||!ghost) return;
    ghost.style.left=(e.clientX-offsetX)+"px";
    ghost.style.top=(e.clientY-offsetY)+"px";

    allZones.forEach(z=>z.classList.remove("hover"));
    const over=document.elementFromPoint(e.clientX,e.clientY);
    const zone=over?.closest?.(".dropzone, .reldrop");
    if(zone) zone.classList.add("hover");
  });

  node.addEventListener("pointerup",(e)=>{
    if(!dragging) return;
    dragging=false;

    allZones.forEach(z=>z.classList.remove("hover"));
    const over=document.elementFromPoint(e.clientX,e.clientY);
    const zone=over?.closest?.(".dropzone, .reldrop");
    if(zone){
      placeItem(zone, node.dataset.itemId, node.dataset.type);
    }

    node.style.opacity="1";
    ghost?.remove(); ghost=null;
  });

  node.addEventListener("pointercancel",()=>{
    dragging=false; node.style.opacity="1"; ghost?.remove(); ghost=null;
  });
}

/* =========================
   INIT
========================= */
renderBank();
resetZonesVisual();
updateProgress();
</script>

</body>
</html>
